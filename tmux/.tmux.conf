# =============================
#  Tmux Configuration (2025)
#  Optimized for performance & UX
# =============================

### Prefix & Key Bindings ###
## Set prefix to C-a (unbind default C-b) and enable sending prefix
unbind C-b
set -g prefix C-a
bind-key C-a send-prefix
# Send prefix key to underlying application
bind-key a send-prefix

# --- Plugins & Extensions ---
# List of plugins using TPM (keep TPM as the first plugin)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# Additional plugins for enhanced UX
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'sainnhe/tmux-fzf'
# Performance optimization plugins
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin '0phoff/gitmux'

## Use vi keys in copy mode
setw -g mode-keys vi


## Copy to system clipboard (macOS)
# For Linux, change "pbcopy" to "xclip -i -sel clipboard" or similar.
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

## Set escape time to 5ms for better responsiveness with Ghostty
set -s escape-time 5

## Enable xterm-keys for better terminal compatibility with Ghostty and other modern terminals
set -g xterm-keys on

## Additional terminal overrides for improved compatibility with Ghostty
set -as terminal-overrides ',*:U8=0'  # Enable Unicode handling
set -as terminal-overrides 'xterm*:smcup@:rmcup@'  # Fix alternate screen issues

## Ghostty-specific terminal overrides to fix escape sequences
set -as terminal-overrides ',xterm-256color:Ms=\E]52;%p1%s;%p2%s\007'  # Better clipboard handling
set -as terminal-overrides ',xterm-256color:Ks=\E[?1l\E>'  # Fix keypad mode
set -as terminal-overrides ',xterm-256color:ke=\E[?1l\E>'  # Fix keypad mode end
set -as terminal-overrides ',xterm-256color:*6=\E[4~'  # Fix end key
set -as terminal-overrides ',xterm-256color:*7=\E[1~'  # Fix home key
## Fix for [O[I escape sequence display issues
set -as terminal-overrides ',xterm-256color:kLFT=\EOD'  # Fix left arrow
set -as terminal-overrides ',xterm-256color:kRIT=\EOC'  # Fix right arrow
set -as terminal-overrides ',xterm-256color:kUP=\EOA'   # Fix up arrow
set -as terminal-overrides ',xterm-256color:kDN=\EOB'   # Fix down arrow
set -as terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[ q'  # Fix cursor shape
set -as terminal-overrides ',*:cursor=\E[\033[?0c'     # Fix cursor reporting

# --- Windows & Panes ---
## Start window and pane numbering at 1 and renumber windows automatically
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

## Performance: Increase scrollback buffer and optimize redraw
set -g history-limit 50000
set -g display-panes-time 400
set -g display-time 500
# Set status interval to 2 seconds for better performance
set -g status-interval 2
# Faster escape time for better responsiveness
set -s escape-time 5
# Reduce repeat time for faster pane switching
set -g repeat-time 200

# --- Activity & Auto Rename ---
setw -g monitor-activity on
set -g visual-activity on

## Auto-rename window based on the current pane's path
# status-interval is set above
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# --- Appearance ---
## Enable true color and italic fonts
set -g default-terminal "tmux-256color"

# --- UX Shortcuts & Macros ---
# Quick pane switching (prefix + h/j/k/l)
set-option -ga terminal-overrides ",xterm-256color:Tc"
set -as terminal-overrides ',xterm*:sitm=\E[3m'

## Theme Plugin: Catppuccin
# Fast window switching (prefix + 1-9)
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavor 'mocha'
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""
set -ogq @catppuccin_window_text ""
set -ogq @catppuccin_window_current_text ""
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right "#{E:@catppuccin_status_session}"
# Quickly swap panes (prefix + < and >)

# --- Continuum & Resurrect ---
# New session (prefix + S)
set -g @continuum-save-interval '15'
set -g @continuum-restore-max-delay '5'
# Rename window (prefix + N)
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-dir '~/tmux-resurrect/recurrect'

# --- FZF Popup Styling ---
# Catppuccin Mocha colors, border, reverse layout, inline info
set-environment -g TMUX_FZF_OPTIONS "-p -w 100% -h 80% -m"
set-environment -g FZF_DEFAULT_OPTS "--color=fg:#cdd6f4,bg:#1e1e2e,hl:#f5e0dc,fg+:#f5e0dc,bg+:#313244,hl+:#f5e0dc,info:#89b4fa,prompt:#f38ba8,spinner:#f38ba8,header:#a6e3a1,border:#89b4fa --border=rounded --layout=reverse --info=inline"
set-environment -g TMUX_FZF_PREVIEW 0
# --- Convenience ---
## Bind R (with prefix) to reload this configuration
bind R source-file ~/.tmux.conf \; display-message "tmux.conf Reloaded!"

# Quick pane resizing
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

# Quick session switching
bind-key C-s choose-session

# Keybindings:
# prefix + w => fuzzy-switch window/pane across all sessions
# These call the helper scripts shipped with the plugin. They run in background (-b)
bind-key w run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/window.sh switch"

# --- Performance Optimizations ---
# Enable mouse support for faster navigation
set -g mouse on
# Faster pane switching with mouse
set -g focus-events on
# Optimize for large terminals
set -g aggressive-resize on
# Reduce redraw frequency
set -g status-interval 2
# Prevent pane movement wrapping for better UX
bind -r Up if -F '#{pane_at_top}' '' 'selectp -U'
bind -r Down if -F '#{pane_at_bottom}' '' 'selectp -D'
bind -r Left if -F '#{pane_at_left}' '' 'selectp -L'
bind -r Right if -F '#{pane_at_right}' '' 'selectp -R'

# --- Initialize TPM ---
run '~/.tmux/plugins/tpm/tpm'
