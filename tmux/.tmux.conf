# =============================
#  Tmux Configuration (2025)
#  Optimized for performance & UX
# =============================

### Prefix & Key Bindings ###
## Set prefix to C-a (unbind default C-b) and enable sending prefix
unbind C-b
set -g prefix C-a
bind-key C-a send-prefix
# Send prefix key to underlying application
bind-key a send-prefix

# --- Plugins & Extensions ---
# List of plugins using TPM (keep TPM as the first plugin)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# Additional plugins for enhanced UX
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'sainnhe/tmux-fzf'

## Use vi keys in copy mode
setw -g mode-keys vi


## Copy to system clipboard (macOS)
# For Linux, change "pbcopy" to "xclip -i -sel clipboard" or similar.
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

## Set escape time to 0 for snappier key response
set -s escape-time 0

# --- Windows & Panes ---
## Start window and pane numbering at 1 and renumber windows automatically
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

## Performance: Increase scrollback buffer and optimize redraw
set -g history-limit 20000
set -g display-panes-time 800
set -g display-time 1000
# Set status interval to 5 seconds for better performance
set -g status-interval 5

# --- Activity & Auto Rename ---
setw -g monitor-activity on
set -g visual-activity on

## Auto-rename window based on the current pane's path
# status-interval is set above
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# --- Appearance ---
## Enable true color and italic fonts
set -g default-terminal "tmux-256color"

# --- UX Shortcuts & Macros ---
# Quick pane switching (prefix + h/j/k/l)
set-option -ga terminal-overrides ",xterm-256color:Tc"
set -as terminal-overrides ',xterm*:sitm=\E[3m'

## Theme Plugin: Catppuccin
# Fast window switching (prefix + 1-9)
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavor 'mocha'
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""
set -ogq @catppuccin_window_text ""
set -ogq @catppuccin_window_current_text ""
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right "#{E:@catppuccin_status_session}"
# Quickly swap panes (prefix + < and >)

# --- Continuum & Resurrect ---
# New session (prefix + S)
set -g @continuum-save-interval '5'
# Rename window (prefix + N)
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-dir '~/tmux-resurrect/recurrect'

# --- FZF Popup Styling ---
# Catppuccin Mocha colors, border, reverse layout, inline info
set-environment -g TMUX_FZF_OPTIONS "-p -w 100% -h 80% -m"
set-environment -g FZF_DEFAULT_OPTS "--color=fg:#cdd6f4,bg:#1e1e2e,hl:#f5e0dc,fg+:#f5e0dc,bg+:#313244,hl+:#f5e0dc,info:#89b4fa,prompt:#f38ba8,spinner:#f38ba8,header:#a6e3a1,border:#89b4fa --border=rounded --layout=reverse --info=inline"
set-environment -g TMUX_FZF_PREVIEW 0
# --- Convenience ---
## Bind R (with prefix) to reload this configuration
bind R source-file ~/.tmux.conf \; display-message "tmux.conf Reloaded!"

# Quick pane resizing
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

# Quick session switching
bind-key C-s choose-session

# Keybindings:
# prefix + w => fuzzy-switch window/pane across all sessions
# These call the helper scripts shipped with the plugin. They run in background (-b)
bind-key w run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/window.sh switch"

# --- Initialize TPM ---
run '~/.tmux/plugins/tpm/tpm'
